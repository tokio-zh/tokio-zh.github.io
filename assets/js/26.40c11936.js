(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{162:function(t,s,n){"use strict";n.r(s);var e=n(0),a=Object(e.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),n("p",[t._v("运行时负责重复调用"),n("code",[t._v("Future")]),t._v("上的"),n("code",[t._v("poll")]),t._v("，直到返回其值。 有许多不同的方法可以做到这一点，因此有许多类型的运行时配置。 例如，"),n("a",{attrs:{href:"https://docs.rs/tokio/0.1/tokio/executor/current_thread/index.html",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("CurrentThread")]),n("OutboundLink")],1),t._v("运行时配置将阻止当前线程并循环遍历所有生成的Futures，并对它们调用poll。 "),n("a",{attrs:{href:"https://docs.rs/tokio-threadpool/0.1.8/tokio_threadpool/",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("ThreadPool")]),n("OutboundLink")],1),t._v("配置在线程池中安排Futures。 这也是Tokio运行时使用的默认配置。")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),n("p",[t._v("任务被传递到运行时，它处理任务的调度。运行时通常在一个或一组线程中调度许多任务。任务不得执行计算量大的逻辑，否则会阻止其他任务执行。因此，不要尝试将斐波那契序列计算为任务！")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),n("p",[t._v("在下一节中，我们将看一个比我们的hello-world示例更为复杂的示例，该示例将我们迄今为止所学到的所有内容都考虑在内。")])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"运行时"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行时","aria-hidden":"true"}},[this._v("#")]),this._v(" 运行时")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在上一节中，我们探讨了"),s("code",[this._v("Futures")]),this._v("和"),s("code",[this._v("Streams")]),this._v("，它们允许我们表示一个值（在Future的情况下）或一系列值（在Stream的情况下）将在“未来的某个时刻”可用。 我们讨论了关于Future和Stream的轮询，运行时将调用它来确定Future或Stream是否已准备好产生值。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("最后，我们说需要运行时来轮询"),s("code",[this._v("Future")]),this._v("和"),s("code",[this._v("Streams")]),this._v("来推动它们完成。 我们现在将仔细研究运行时。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"tokio-runtime"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tokio-runtime","aria-hidden":"true"}},[this._v("#")]),this._v(" Tokio runtime")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("为了让"),s("code",[this._v("Future")]),this._v("取得进步，必须要调用"),s("code",[this._v("poll")]),this._v("。 这是运行时的工作。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("重要的是要记住，所有"),s("code",[this._v("Future")]),this._v("必须在运行时生成，否则不会执行任何工作。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"产生任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#产生任务","aria-hidden":"true"}},[this._v("#")]),this._v(" 产生任务")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Tokio的一个独特方面是"),s("code",[this._v("Future")]),this._v("可以在运行时从其他"),s("code",[this._v("Future")]),this._v("或流中产生。当我们以这种方式使用"),s("code",[this._v("Future")]),this._v("时，我们通常将它们称为任务。任务是应用程序的“逻辑单元”。它们类似于[Go的goroutine]和[Erlang的过程]，但是异步。换句话说，任务是异步绿色线程。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("鉴于任务运行异步逻辑位，它们由Future特征表示。任务完成处理后，任务的"),s("code",[this._v("Future")]),this._v("实现将以（）值完成。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("任务通过使用"),s("code",[this._v("Future")]),this._v("和"),s("code",[this._v("Tokio")]),this._v("中可用的各种组合函数或通过直接实现Tokio特征来构建Tokio来实现。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们可以使用"),s("code",[this._v("tokio :: spawn")]),this._v("生成任务。例如：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-rust extra-class"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create some kind of future that we want our runtime to execute")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" program "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" my_outer_stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("for_each")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token closure-params"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("my_outer_value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("println!")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Got value {:?} from the stream"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" my_outer_value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  # "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" my_inner_future "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" future"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ok")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" task "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" my_inner_future"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("and_then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token closure-params"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("my_inner_value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("println!")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Got a value {:?} from second future"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" my_inner_value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  tokio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("spawn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\ntokio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("program"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("再次产生任务可以在其他"),s("code",[this._v("Future")]),this._v("或流中产生，允许多个事物同时产生。 在上面的例子中，我们从外部流中产生了内在的"),s("code",[this._v("Future")]),this._v("。 每当我们从流中获得一个值时，我们就会简单地运行内在的"),s("code",[this._v("Future")]),this._v("。")])}],!1,null,null,null);s.default=a.exports}}]);