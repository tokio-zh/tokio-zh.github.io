(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{144:function(t,n,s){"use strict";s.r(n);var a=s(0),e=Object(a.a)({},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p",[t._v("祝所有人快乐！")]),t._v(" "),s("p",[t._v("为了结束一个伟大的一周，有一个[新发布]的Tokio。这个版本\n包括一个全新的计时器实现。")]),t._v(" "),t._m(1),t._v(" "),s("p",[t._v("有时（通常），人们想要执行与时间相关的代码。也许是\n功能需要在特定时刻运行。也许阅读需要有限\n到固定的时间。为了处理时间，需要访问计时器！")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),s("p",[t._v("但是，有些情况下100毫秒太粗糙。而且，\nTokio计时器的原始实现有一些恼人的错误，但没有\n由于实施策略，处理边缘案例非常好。")]),t._v(" "),t._m(4),t._v(" "),s("p",[t._v("计时器已从头开始重写并作为["),s("code",[t._v("tokio-timer")]),t._v("发布\n0.2] "),s("a",{attrs:{href:"https://crates.io/crates/tokio-timer/0.2.0",target:"_blank",rel:"noopener noreferrer"}},[t._v("2"),s("OutboundLink")],1),t._v("。在大多数情况下，API非常相似，但实现是\n完全不同。")]),t._v(" "),s("p",[t._v("它不使用单个哈希定时器轮实现，而是使用\n分层方法（也在上面链接的论文中描述）。")]),t._v(" "),s("p",[t._v("计时器使用六个不同的级别。每个级别都是一个包含64的散列轮\n插槽。最低级别的插槽代表一毫秒。该\n下一级别表示64毫秒（1 x 64个插槽），依此类推。所以，一个插槽\n每个级别的时间与下面的整个级别相同。")]),t._v(" "),s("p",[t._v("设置超时后，如果距离当前时刻64毫秒内，\n它处于最低水平。如果超时在64毫秒和4,096之间\n毫秒，它进入第二级，依此类推。")]),t._v(" "),s("p",[t._v("随着时间的推移，最低级别的超时被触发。一旦结束了\n达到最低级别，从中删除下一级别的所有超时\n水平并移至最低水平。")]),t._v(" "),s("p",[t._v("使用此策略，所有计时器操作（创建超时，取消a\n超时，触发超时）是不变的。这导致非常好的性能\n即使有很多突出的超时。")]),t._v(" "),t._m(5),t._v(" "),s("p",[t._v("如上所述，API并没有真正改变。主要有三个\n类型：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.rs/tokio/0.1/tokio/timer/struct.Delay.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Delay")]),s("OutboundLink")],1),t._v("：在设定的时刻完成的未来。")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.rs/tokio/0.1/tokio/timer/struct.Deadline.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Deadline")]),s("OutboundLink")],1),t._v("：装饰一个未来，确保它在之前完成\n  截止日期已到达。")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.rs/tokio/0.1/tokio/timer/struct.Interval.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Interval")]),s("OutboundLink")],1),t._v("：以固定间隔产生值的流。")])]),t._v(" "),s("p",[t._v("还有一个简单的例子：")]),t._v(" "),t._m(6),t._m(7),t._v(" "),t._m(8),t._v(" "),s("p",[t._v("此版本附带一个简短的[指南]，解释如何使用计时器和[API\n文档】"),s("a",{attrs:{href:"https://docs.rs/tokio/0.1/tokio/timer/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("API"),s("OutboundLink")],1),t._v("。")]),t._v(" "),t._m(9),t._v(" "),s("p",[t._v("使用计时器API需要运行计时器实例。 Tokio [运行时]\n为您完成所有设置。")]),t._v(" "),t._m(10),t._v(" "),s("p",[t._v("有了这个，周末愉快！")])])},[function(){var t=this.$createElement,n=this._self._c||t;return n("h1",{attrs:{id:"新的timer实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#新的timer实现","aria-hidden":"true"}},[this._v("#")]),this._v(" 新的Timer实现")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"定时器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#定时器","aria-hidden":"true"}},[this._v("#")]),this._v(" 定时器")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"历史"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#历史","aria-hidden":"true"}},[this._v("#")]),this._v(" 历史")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("code",[this._v("tokio-timer")]),this._v("箱子已经存在了一段时间。它最初建成\n使用[哈希定时器轮] [轮]（pdf警告）。它的粒度为100\n毫秒，因此任何超时设置的分辨率都小于100毫秒\n会被围捕。通常，在基于网络的应用程序的上下文中，\n这可以。超时通常至少30秒，并不需要很高\n精确。")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"一个新的开始"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一个新的开始","aria-hidden":"true"}},[this._v("#")]),this._v(" 一个新的开始")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"快速浏览一下api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#快速浏览一下api","aria-hidden":"true"}},[this._v("#")]),this._v(" 快速浏览一下API")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-rust extra-class"},[s("pre",{pre:!0,attrs:{class:"language-rust"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" tokio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("prelude"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" tokio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("timer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("Delay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" std"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Duration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Instant"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" when "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Instant"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" Duration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("from_millis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" task "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Delay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("new")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("when"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("and_then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token closure-params"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println!")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello world!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map_err")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("panic!")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"delay errored; err={:?}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    tokio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("p",[t._v("上面的例子创建了一个新的"),s("code",[t._v("Delay")]),t._v("实例，它将完成100\n将来的毫秒数。 "),s("code",[t._v("new")]),t._v("函数接受"),s("code",[t._v("Instant")]),t._v("，所以我们计算\n"),s("code",[t._v("when")]),t._v("是从现在起100毫秒的瞬间。")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[this._v("一旦到达瞬间，“延迟”未来就会完成，从而产生\n"),n("code",[this._v("and_then")]),this._v("块被执行。")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"集成在运行时中"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#集成在运行时中","aria-hidden":"true"}},[this._v("#")]),this._v(" 集成在运行时中")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("p",[t._v("当使用"),s("code",[t._v("tokio :: run")]),t._v("或通过调用"),s("code",[t._v("Runtime :: new")]),t._v("启动运行时\n直接启动线程池。每个工作线程将获得一个计时器\n实例。所以，这意味着如果运行时启动了4个工作线程，那么就会有\n是4个计时器实例，每个线程一个。这样做可以不使用计时器\n支付同步成本，因为计时器将位于同一个线程上\n作为使用各种计时器类型的代码（"),s("code",[t._v("Delay")]),t._v("，"),s("code",[t._v("Deadline")]),t._v("，"),s("code",[t._v("Interval")]),t._v("）。")])}],!1,null,null,null);n.default=e.exports}}]);