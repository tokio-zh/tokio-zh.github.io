(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{175:function(t,s,e){"use strict";e.r(s);var n=e(0),a=Object(n.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),e("p",[t._v("使用Tokio编写的应用程序组织在大量小的非阻塞任务中。 Tokio任务类似于"),e("a",{attrs:{href:"https://www.golang-book.com/books/intro/10#section1",target:"_blank",rel:"noopener noreferrer"}},[t._v("goroutine"),e("OutboundLink")],1),t._v("或者"),e("a",{attrs:{href:"http://erlang.org/doc/reference_manual/processes.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Erlang进程"),e("OutboundLink")],1),t._v("，但是是非阻塞的。它们设计为轻量级，可以快速生成，并保持较低的调度开销。它们也是非阻塞的，因为无法立即完成的此类操作必须立即返回。它们返回一个表示操作正在进行的值，而不是返回操作的结果,表明操作正在进行中。")]),t._v(" "),t._m(1),t._v(" "),e("p",[t._v("使用"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/future/trait.Future.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Future"),e("OutboundLink")],1),t._v(" trait实现Tokio任务：")]),t._v(" "),t._m(2),e("p",[t._v("使用"),e("code",[t._v("tokio :: spawn")]),t._v("或通过调用"),e("code",[t._v("executor")]),t._v("对象上的"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/executor/struct.Spawn.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spawn"),e("OutboundLink")],1),t._v("方法将任务提交给 "),e("code",[t._v("executor")]),t._v("。 "),e("code",[t._v("poll")]),t._v("函数驱动任务。没有调用"),e("code",[t._v("poll")]),t._v("就什么都不做。在任务上调用"),e("code",[t._v("poll")]),t._v("直到"),e("code",[t._v("Ready（（））")]),t._v("返回是 "),e("code",[t._v("executor")]),t._v("的工作。")]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),e("p",[t._v("因此，实现"),e("code",[t._v("poll")]),t._v("在很短的时间内执行才是重要的。对于I / O绑定的应用程序，通常会发生这种情况。但是，如果任务预计必须长时间运行，则应该推迟工作到"),e("a",{attrs:{href:"https://docs.rs/tokio-threadpool/0.1/tokio_threadpool/fn.blocking.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("blocking pool"),e("OutboundLink")],1),t._v("或将计算分解为更小的块和在每个块执行之后"),e("a",{attrs:{href:"https://tokio.rs/docs/internals/runtime-model/#yielding",target:"_blank",rel:"noopener noreferrer"}},[t._v("yield"),e("OutboundLink")],1),t._v("回来。")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),e("p",[t._v("通过两个API完成跟踪兴趣并通知准备情况的变化：")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/task/fn.current.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("task::current")]),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/task/struct.Task.html#method.notify",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Task::notify")]),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("当调用"),e("code",[t._v("my_resource.poll（）")]),t._v("时，如果资源准备就绪，则立即返回值而不使用任务系统。如果资源"),e("strong",[t._v("没有")]),t._v("准备好，通过调用"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/task/fn.current.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("task::current() -> Task")]),e("OutboundLink")],1),t._v(" 来获取当前任务的句柄。这是通过读取"),e("code",[t._v("executor")]),t._v("设置的线程局部变量集获得此句柄。")]),t._v(" "),e("p",[t._v("一些外部事件（在网络上接收的数据，后台线程完成计算等...)将导致"),e("code",[t._v("my_resource")]),t._v("准备好生成它的值。那时，准备好"),e("code",[t._v("my_resource")]),t._v("的逻辑将调用从"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/task/fn.current.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("task :: current")]),e("OutboundLink")],1),t._v("获得的任务句柄上的"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/executor/trait.Notify.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("notify")]),e("OutboundLink")],1),t._v("。这个表示准备就绪会改变 "),e("code",[t._v("executor")]),t._v("， "),e("code",[t._v("executor")]),t._v("随后安排任务执行。")]),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),e("p",[t._v("任何返回"),e("code",[t._v("Async")]),t._v("的函数都必须遵守"),e("a",{attrs:{href:"https://docs.rs/futures/0.1.23/futures/future/trait.Future.html#tymethod.poll",target:"_blank",rel:"noopener noreferrer"}},[t._v("contract"),e("OutboundLink")],1),t._v("(契约)。 当返回"),e("code",[t._v("NotReady")]),t._v("，当前任务"),e("strong",[t._v("必须")]),t._v("已经注册准备就绪的变更通知。 以上部分讨论了资源的含义。 对于任务逻辑，这意味着无法返回"),e("code",[t._v("NotReady")]),t._v("除非资源已返回“NotReady”。 通过这样做，"),e("a",{attrs:{href:"https://docs.rs/futures/0.1.23/futures/future/trait.Future.html#tymethod.poll",target:"_blank",rel:"noopener noreferrer"}},[t._v("contract"),e("OutboundLink")],1),t._v("得到了传承。 当前任务已注册通知，因为已从资源收到"),e("code",[t._v("NotReady")]),t._v("。")]),t._v(" "),t._m(16),t._v(" "),t._m(17),e("p",[t._v("上面实现的问题是"),e("code",[t._v("Ok（Async :: NotReady）")]),t._v("是在将状态转换为"),e("code",[t._v("Second")]),t._v("后立即返回。 在这转换中，没有资源返回"),e("code",[t._v("NotReady")]),t._v("。 当任务本身返回时"),e("code",[t._v("NotReady")]),t._v("，它违反了"),e("a",{attrs:{href:"https://docs.rs/futures/0.1.23/futures/future/trait.Future.html#tymethod.poll",target:"_blank",rel:"noopener noreferrer"}},[t._v("contract"),e("OutboundLink")],1),t._v(" ，因为任务将来不会被通知。")]),t._v(" "),e("p",[t._v("通常通过添加循环来解决这种情况：")]),t._v(" "),t._m(18),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),e("p",[t._v("Yielding 是通过通知当前任务并返回“NotReady”完成：")]),t._v(" "),t._m(23),e("p",[t._v("Yield可用于分解CPU昂贵的计算：")]),t._v(" "),t._m(24),t._m(25),t._v(" "),t._m(26),t._v(" "),e("p",[t._v("通过将任务系统与 "),e("code",[t._v("executor")]),t._v("实现分离，具体执行和调度逻辑可以留给 "),e("code",[t._v("executor")]),t._v("实现。"),e("code",[t._v("tokio")]),t._v("提供两个"),e("code",[t._v("executor")]),t._v("实现，每个实现具有独特的特点："),e("a",{attrs:{href:"http://docs.rs/tokio-current-thread",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("current_thread")]),e("OutboundLink")],1),t._v("和"),e("a",{attrs:{href:"https://docs.rs/tokio-threadpool",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("thread_pool")]),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("p",[t._v("当任务首次在"),e("code",[t._v("executor")]),t._v("之上生成时， "),e("code",[t._v("executor")]),t._v("用"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/executor/struct.Spawn.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Spawn")]),e("OutboundLink")],1),t._v("将其包装。这将任务逻辑与任务状态绑定（这主要是遗留原因所需要的）。 "),e("code",[t._v("executor")]),t._v("通常会将任务存储在堆，通常是将它存储在"),e("code",[t._v("Box")]),t._v("或"),e("code",[t._v("Arc")]),t._v("中。当 "),e("code",[t._v("executor")]),t._v("选择一个执行任务，它调用"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/executor/struct.Spawn.html#method.poll_future_notify",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Spawn :: poll_future_notify")]),e("OutboundLink")],1),t._v("。此函数确保将任务上下文设置为线程局部变量像"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/task/fn.current.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("task :: current")]),e("OutboundLink")],1),t._v("能够读取它。")]),t._v(" "),e("p",[t._v("当调用"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/executor/struct.Spawn.html#method.poll_future_notify",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("poll_future_notify")]),e("OutboundLink")],1),t._v("时， "),e("code",[t._v("executor")]),t._v("也是传递通知句柄和标识符。这些参数包含在由"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/task/fn.current.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("task :: current")]),e("OutboundLink")],1),t._v("返回的任务句柄中，也是有关任务与"),e("code",[t._v("executor")]),t._v("连接的方式。")]),t._v(" "),e("p",[t._v("notify句柄是"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/executor/trait.Notify.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Notify")]),e("OutboundLink")],1),t._v(" 的实现，标识符是 "),e("code",[t._v("executor")]),t._v("用于查找当前任务的值。当调用"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/task/struct.Task.html#method.notify",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Task::notify")]),e("OutboundLink")],1),t._v("，"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/executor/trait.Notify.html#tymethod.notify",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("notify")]),e("OutboundLink")],1),t._v("函数使用提供的标识符调用notify句柄。该函数的实现负责执行调度逻辑。")]),t._v(" "),e("p",[t._v("实现 "),e("code",[t._v("executor")]),t._v("的一种策略是将每个任务存储在"),e("code",[t._v("Box")]),t._v("和使用链接列表来跟踪计划执行的任务。当调用"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/executor/trait.Notify.html#tymethod.notify",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Notify :: notify")]),e("OutboundLink")],1),t._v("，然后将与之关联的任务标识符被推送到"),e("code",[t._v("scheduled")]),t._v("链表的末尾。当 "),e("code",[t._v("executor")]),t._v("运行时，它从链表的前端弹出并执行任务如上所述。")]),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),e("p",[t._v("通常，资源本身不能起作用而是需要drivers。例如，Tokio TCP套接字由"),e("a",{attrs:{href:"https://docs.rs/tokio-reactor/0.1.5/tokio_reactor/",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Reactor")]),e("OutboundLink")],1),t._v("支持。"),e("code",[t._v("Reactor")]),t._v("是socket资源driver。单个driver可以为大量资源实例提供动力。要使用该资源，drivers必须在某处运行这个过程。 Tokio提供网络资源的drivers（"),e("a",{attrs:{href:"https://docs.rs/tokio-reactor",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("tokio-reactor")]),e("OutboundLink")],1),t._v("），文件资源（"),e("a",{attrs:{href:"https://docs.rs/tokio-fs",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("tokio-fs")]),e("OutboundLink")],1),t._v("）和定时器（"),e("a",{attrs:{href:"https://docs.rs/tokio-timer",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("tokio-timer")]),e("OutboundLink")],1),t._v("）。提供解耦driver组件允许用户选择他们想要使用的组件。每个driver可以单独使用或与其他driver结合使用。")]),t._v(" "),t._m(30),t._v(" "),e("p",[t._v("Tokio提供"),e("a",{attrs:{href:"https://docs.rs/tokio/0.1.8/tokio/runtime/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("并发运行时"),e("OutboundLink")],1),t._v("和"),e("a",{attrs:{href:"https://docs.rs/tokio/0.1.8/tokio/runtime/current_thread/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("单线程"),e("OutboundLink")],1),t._v("运行时。并发运行时基于多线程、工作窃取 "),e("code",[t._v("executor")]),t._v("。单线程运行时执行当前线程上的所有任务和drivers。用户可以选择最适合应用的运行时。")]),t._v(" "),t._m(31),t._v(" "),e("p",[t._v("如上所述，任务是使用"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/future/trait.Future.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Future"),e("OutboundLink")],1),t._v(" "),e("code",[t._v("trait")]),t._v("实现的。 这个特点不仅限于实施任务。 一个 "),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/future/trait.Future.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Future"),e("OutboundLink")],1),t._v("是表示一个非阻塞计算的值在未来的某个时间完成。 任务是一个计算没有输出。 Tokio中的许多资源都用"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/future/trait.Future.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Future"),e("OutboundLink")],1),t._v("实现。 例如，超时是"),e("a",{attrs:{href:"https://docs.rs/futures/0.1/futures/future/trait.Future.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Future"),e("OutboundLink")],1),t._v("在达到截止日期后完成。")]),t._v(" "),t._m(32),t._v(" "),t._m(33)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"运行时模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行时模型","aria-hidden":"true"}},[this._v("#")]),this._v(" 运行时模型")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"非阻塞执行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#非阻塞执行","aria-hidden":"true"}},[this._v("#")]),this._v(" 非阻塞执行")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-rust extra-class"},[e("pre",{pre:!0,attrs:{class:"language-rust"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" MyTask "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    my_resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MyResource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("impl")]),t._v(" Future "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" MyTask "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Item "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Error "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mut")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("->")]),t._v(" Poll"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("Item"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("Error"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("match")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("my_resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ready")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("process")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ready")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("NotReady"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("NotReady"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Err")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("process_err")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ready")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("MyTask")]),this._v("将从"),s("code",[this._v("my_resource")]),this._v("接收一个值并处理它。一旦值处理完毕，任务就完成了他的逻辑并结束。这会返回"),s("code",[this._v("Ok（Async :: Ready（（）））")]),this._v("。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("为了完成处理，任务取决于"),e("code",[t._v("my_resource")]),t._v("提供的值。鉴于"),e("code",[t._v("my_resource")]),t._v("是一个非阻塞任务，它在调用"),e("code",[t._v("my_resource.poll（）")]),t._v("时，可能准备好或者还没准备好提供值。如果它准备就绪，它返回"),e("code",[t._v("Ok（Async :: Ready（value））")]),t._v("。如果没有准备好，它会返回"),e("code",[t._v("Ok(Async::NotReady)")]),t._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("当资源未准备好提供值时，这意味着该任务本身还没准备好完成，任务的"),s("code",[this._v("poll")]),this._v("函数也返回"),s("code",[this._v("NotReady")]),this._v("。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("在未来的某个时刻，资源将随时准备提供值。资源使用任务系统向 "),e("code",[t._v("executor")]),t._v("发信号给"),e("code",[t._v("executor")]),t._v("通知它已准备好。 "),e("code",[t._v("executor")]),t._v("安排任务，导致"),e("code",[t._v("MyTask :: poll")]),t._v("又叫了一遍。这一次，假设"),e("code",[t._v("my_resource")]),t._v("准备就绪，那么值就是从"),e("code",[t._v("my_resource.poll（）")]),t._v("返回并且任务完成。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"协作调度"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#协作调度","aria-hidden":"true"}},[this._v("#")]),this._v(" 协作调度")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("协作调度用于在 "),s("code",[this._v("executor")]),this._v("上调度任务。单个 "),s("code",[this._v("executor")]),this._v("将通过一小组线程管理许多任务。将有比线程更多的任务。这也没有抢占。这个意味着当任务被安排执行时，它会阻止当前线程直到"),s("code",[this._v("poll")]),this._v("函数返回。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"任务系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#任务系统","aria-hidden":"true"}},[this._v("#")]),this._v(" 任务系统")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("任务系统是资源通知"),s("code",[this._v("executor")]),this._v("准备就绪的系统。 任务由消耗资源的非阻塞逻辑组成。 在上面的示例中，"),s("code",[this._v("MyTask")]),this._v("使用单个资源"),s("code",[this._v("my_resource")]),this._v("，但没有限制任务可以使用的资源数量。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("当任务正在执行并尝试使用未准备好的资源时，它在该资源上被"),s("em",[this._v("逻辑")]),this._v("阻塞，即任务无法进一步处理，直到资源准备就绪。 Tokio跟踪阻塞当前任务的资源以进行推进。当一个依赖资源准备就绪， "),s("code",[this._v("executor")]),this._v("安排任务。这是通过跟踪"),s("strong",[this._v("当任务在资源中表现兴趣")]),this._v("完成。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("当"),e("code",[t._v("MyTask")]),t._v("执行，尝试使用"),e("code",[t._v("my_resource")]),t._v("和"),e("code",[t._v("my_resource")]),t._v("返回"),e("code",[t._v("NotReady")]),t._v("时，"),e("code",[t._v("MyTask")]),t._v("隐含表示对"),e("code",[t._v("my_resource")]),t._v("资源感兴趣。对此，任务和资源是连接的。什么时候资源准备就绪，任务再次被安排。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"task-current和task-notify"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#task-current和task-notify","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("task :: current")]),this._v("和"),s("code",[this._v("Task :: notify")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果多个任务表示对资源感兴趣，则只有"),s("strong",[this._v("last")]),this._v("任务这样做会得到通知。资源旨在从单一任务使用。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"async-notready"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#async-notready","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("Async :: NotReady")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("必须非常小心避免在没有从资源收到"),s("code",[this._v("NotReady")]),this._v("的情况下返回"),s("code",[this._v("NotReady")]),this._v("。 例如，以下任务中，任务实现结果永远不会完成。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-rust extra-class"},[e("pre",{pre:!0,attrs:{class:"language-rust"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" futures"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Future"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Poll"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v(" BadTask "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("First")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Resource1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Second")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Resource2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("impl")]),t._v(" Future "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" BadTask "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Item "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Error "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mut")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("->")]),t._v(" Poll"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("Item"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("Error"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" BadTask"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" value "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("match")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("First")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ref")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mut")]),t._v(" resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("try_ready!")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Second")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ref")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mut")]),t._v(" resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("try_ready!")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ready")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Second")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Resource2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("new")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("NotReady"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-rust extra-class"},[e("pre",{pre:!0,attrs:{class:"language-rust"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" futures"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Future"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Poll"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mut")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("->")]),t._v(" Poll"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("Item"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("Error"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" BadTask"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("loop")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" value "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("match")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("First")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ref")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mut")]),t._v(" resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("try_ready!")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Second")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ref")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mut")]),t._v(" resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("try_ready!")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resource"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ready")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Second")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Resource2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("new")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("思考它的一种方法是任务的"),s("code",[this._v("poll")]),this._v("函数"),s("strong",[this._v("不能")]),this._v("返回，直到由于其资源不能进一步取得进展而准备就绪或明确"),s("code",[this._v("yields")]),this._v("（见下文）。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("另请注意，返回"),s("code",[this._v("Async")]),this._v("的"),s("strong",[this._v("函数只能从一个任务调用")]),this._v("。 换句话说，这些函数只能从已经提交给"),s("code",[this._v("tokio :: spawn")]),this._v("或其他任务spawn函数调用")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"yielding"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yielding","aria-hidden":"true"}},[this._v("#")]),this._v(" Yielding")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("有时，任务必须返回"),s("code",[this._v("NotReady")]),this._v("而不是在资源上被阻塞。这通常发生在运行计算很大且任务想要的时候将控制权交还 "),s("code",[this._v("executor")]),this._v("以允许其执行其他 "),s("code",[this._v("future")]),this._v("。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-rust extra-class"},[e("pre",{pre:!0,attrs:{class:"language-rust"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" futures"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("task"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" futures"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Yield the current task. The executor will poll this task next")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// iteration through its run list.")]),t._v("\ntask"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("current")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("notify")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("NotReady"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-rust extra-class"},[e("pre",{pre:!0,attrs:{class:"language-rust"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" Count "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    remaining"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" usize"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("impl")]),t._v(" Future "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" Count "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Item "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Error "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mut")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("->")]),t._v(" Poll"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("Item"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("Error"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("remaining "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("remaining "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Yield every 10 iterations")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("remaining "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                task"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("current")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("notify")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("NotReady"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ok")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ready")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"executor"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#executor","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("executor")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[e("code",[t._v("executor")]),t._v("员负责驱动完成许多任务。任务是产生于 "),e("code",[t._v("executor")]),t._v("之上， 是在"),e("code",[t._v("executor")]),t._v("需要调用它的"),e("code",[t._v("poll")]),t._v("函数的时候。 "),e("code",[t._v("executor")]),t._v("挂钩到任务系统以接收资源准备通知。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("请注意，本节未介绍 "),e("code",[t._v("executor")]),t._v("的运行方式。细节这留给 "),e("code",[t._v("executor")]),t._v("实现。一个选项是 "),e("code",[t._v("executor")]),t._v("产生一个或多个线程并将这些线程专用于排出"),e("code",[t._v("scheduled")]),t._v("链表。另一个是提供一个"),e("code",[t._v("MyExecutor :: run")]),t._v("函数阻塞当前线程并排出"),e("code",[t._v("scheduled")]),t._v("链表。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"资源，drivers和运行时"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#资源，drivers和运行时","aria-hidden":"true"}},[this._v("#")]),this._v(" 资源，drivers和运行时")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("资源是叶子"),e("code",[t._v("futures")]),t._v("，即未以其他"),e("code",[t._v("futures")]),t._v("实施的"),e("code",[t._v("futures")]),t._v("。它们是使用上述任务系统的类型与 "),e("code",[t._v("executor")]),t._v("互动。资源类型包括TCP和UDP套接字，定时器，通道，文件句柄等.Tokio应用程序很少需要实现资源。相反，他们使用Tokio或第三方包装箱提供的资源。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("正因为如此，为了使用Tokio并成功执行任务，一个应用程序必须启动 "),s("code",[this._v("executor")]),this._v("和必要的drivers作为应用程序的任务依赖的资源。这需要大量的样板。为了管理样板，Tokio提供了几个运行时选项。运行时是与所有必需drivers捆绑在一起的"),s("code",[this._v("executor")]),this._v("，以便为Tokio的资源提供动力。不是单独管理所有各种Tokio组件，而是在一次调用中创建并启动运行时。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"future"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#future","aria-hidden":"true"}},[this._v("#")]),this._v(" Future")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("该 "),s("code",[this._v("trait")]),this._v("包括许多与Future值一起工作的有用的组合器。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("通过对应用特定类型实现"),s("code",[this._v("Future")]),this._v("来构建应用或使用组合器来定义应用程序逻辑。 通常两者兼而有之策略是最成功的。")])}],!1,null,null,null);s.default=a.exports}}]);